unit PerfilView;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants, 
  FMX.Types, FMX.Graphics, FMX.Controls, FMX.Forms, FMX.Dialogs, FMX.StdCtrls,
  Main, FMX.Objects, FMX.Edit, FMX.Controls.Presentation, FMX.Ani, UsuarioModel,
  PerfilController;

type
  TForm4 = class(TForm1)
    RecMenu: TRectangle;
    lblNome: TLabel;
    txtNome: TEdit;
    lblEmail: TLabel;
    txtPeso: TEdit;
    lblQuilo: TLabel;
    lblAltura: TLabel;
    txtAltura: TEdit;
    lblMetros: TLabel;
    lblIMC: TLabel;
    lblValorIMC: TLabel;
    lblDescIMC: TLabel;
    btnSalvar: TButton;
    procedure FormShow(Sender: TObject);
    procedure btnSalvarClick(Sender: TObject);
  private
    procedure CalculaIMC();
  public
    PerfilControlador: TFrame4;
    constructor Create(Usuarios: TUsuario);

  end;

var
  Form4: TForm4;
  Usuario: TUsuario;

implementation

{$R *.fmx}

constructor TForm4.Create(Usuarios: TUsuario);
begin
  Usuario := Usuarios;

  PerfilControlador := TFrame4.Create(self);
end;

procedure TForm4.FormShow(Sender: TObject);
begin
  inherited;

  txtNome.Text := Usuario.FNome;
  txtPeso.Text := Usuario.FPeso.ToString;
  txtAltura.Text := Usuario.FAltura.ToString;
  CalculaIMC;
end;

procedure TForm4.btnSalvarClick(Sender: TObject);
var
  fs: TFormatSettings;
begin
  inherited;
  fs := TFormatSettings.Create;
  fs.DecimalSeparator := '.';

  Usuario.FNome := txtNome.Text;
  Usuario.FPeso := StrToFloat(txtPeso.Text, fs);
  Usuario.FAltura := StrToFloat(txtAltura.Text, fs);

  PerfilControlador.AtualizaUsuario(Usuario);
  CalculaIMC;
end;

procedure TForm4.CalculaIMC();
var
  IMC: Double;
begin

    IMC := Usuario.FPeso / Sqr(Usuario.FAltura);

    lblValorImc.Text := FormatFloat('0.0', IMC);

    if IMC < 18.5 then
    begin
      lblDescIMC.Text := 'Baixo peso';
      lblDescIMC.TextSettings.FontColor := TColors.Blue;
    end
    else if IMC < 25 then
    begin
      lblDescIMC.Text := 'Peso normal';
      lblDescIMC.TextSettings.FontColor := TColors.Green;
    end
    else if IMC < 30 then
    begin
      lblDescIMC.Text := 'Sobrepeso';
      lblDescIMC.TextSettings.FontColor := TColors.Yellow;
    end
    else
    begin
      lblDescIMC.Text := 'Obesidade';
      lblDescIMC.TextSettings.FontColor := TColors.Red;
    end;

end;

end.
